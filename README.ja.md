# bandstat

bandstat はリファレンストラックとミックスを比較するためのコマンドライン周波数帯域アナライザーです。

[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)
[![Rust](https://img.shields.io/badge/Rust-1.85+-orange.svg)](https://www.rust-lang.org/)

## 使用例

リファレンストラックとミックスを比較する例です。

```
$ bandstat -q your_mix.wav reference.wav
Comparison (base: [A]):
  [A] your_mix.wav
  [B] reference.wav

[Band Power Distribution]
            DC  SUB1  SUB2  BASS  UBAS  LMID   MID  UMID  HMID  PRES  BRIL  HIGH  UHIG   AIR
--------------------------------------------------------------------------------------------
[A]Raw     0.0   0.1   9.1  18.1  21.2  12.1  12.2  10.4  11.6   3.3   1.5   0.3   0.0   0.0
[A]K-wt    0.0   0.0   2.7  10.1  16.4  10.5  11.4  13.7  23.8   7.3   3.3   0.6   0.1   0.0
[A]Diff    0.0  -0.1  -6.4  -8.0  -4.7  -1.7  -0.8  +3.3 +12.2  +4.0  +1.8  +0.4  +0.1   0.0
--------------------------------------------------------------------------------------------
[B]Raw     0.0   0.1   9.2  31.7  15.7   7.0  12.4  10.4   8.4   2.9   2.0   0.2   0.0   0.0
[B]K-wt    0.0   0.1   7.5  25.6  12.6   5.6  10.5  12.5  15.4   5.8   3.9   0.5   0.1   0.0
[B]Diff    0.0   0.0  -1.7  -6.2  -3.1  -1.4  -1.9  +2.1  +7.0  +2.9  +2.0  +0.3   0.0   0.0
--------------------------------------------------------------------------------------------
B-A Raw    0.0   0.0  +0.1 +13.6  -5.5  -5.1  +0.1   0.0  -3.2  -0.4  +0.5   0.0   0.0   0.0
B-A K-wt   0.0  +0.1  +4.8 +15.5  -3.9  -4.9  -0.9  -1.3  -8.4  -1.5  +0.7  -0.1   0.0   0.0
```

**読み方**: B-A Raw の BASS が +13.6% なので、リファレンスの方が低域が 13.6% 多いことを示しています。K-wt の HMID が 23.8% と高く、その帯域が聴感上目立って聞こえます。

セクションごとの帯域バランスの変化を確認することもできます。

```
$ bandstat -tq audio.wav
TIME      DC  SUB1  SUB2  BASS  UBAS  LMID   MID  UMID  HMID  PRES  BRIL  HIGH  UHIG   AIR
------------------------------------------------------------------------------------------
00:00    0.0   0.1   4.5  11.2  15.7  21.8  22.0  15.1   6.1   2.1   1.1   0.3   0.1   0.0
00:20    0.0   0.1   9.4  15.6  27.0   9.2   9.7   9.0  14.3   3.7   1.6   0.4   0.1   0.0
00:40    0.0   0.1  12.6  23.8  21.3   8.4   7.4   7.7  13.0   3.6   1.7   0.3   0.0   0.0
01:00    0.0   0.1  10.1  24.6  18.3   7.5   9.0  10.1  14.2   4.6   1.4   0.2   0.0   0.0
------------------------------------------------------------------------------------------
AVG      0.0   0.1   9.1  18.0  21.1  12.2  12.3  10.4  11.6   3.3   1.5   0.3   0.0   0.0
```

曲全体の平均値がセクションごとの実態を反映しない場合に有用です。例えばミッドが薄いイントロと低域が厚いサビが混在するような曲で、各パートの帯域バランスを個別に確認できます。

## なぜ bandstat?

リファレンス曲と自分のミックスを聴き比べて「何かが違う」と感じても、どの帯域がどれくらい違うのかを把握するのは難しいです。スペクトラムアナライザーではリアルタイムの波形から差を読み取りづらく、曖昧な判断になりがちです。

bandstat は2つの音源から各帯域のパワー分布をパーセンテージで算出し、差分を出力します。「BASS が 13% 少なく、HMID が 8% 多い」のように違いが数値で明確になります。パーセンテージ表記のため、LUFS が異なる音源同士でもそのまま比較できます。

## 機能

* 14の周波数帯域（DC から AIR）
* [ITU-R BS.1770-4](https://www.itu.int/rec/R-REC-BS.1770) に基づく K-weighting（44.1/48kHz に最適化）
* 帯域ごとのダイナミクス分析
* 最大10ファイルを比較
* タイムラインモードで時間経過による変化を追跡

## インストール

[Releases](../../releases) に以下のプラットフォーム向けのビルド済みバイナリがあります。

| プラットフォーム | アーカイブ |
|------------------|------------|
| **macOS (Apple Silicon)** | `bandstat-vX.X.X-aarch64-apple-darwin.tar.gz` |
| **macOS (Intel)** | `bandstat-vX.X.X-x86_64-apple-darwin.tar.gz` |
| **Linux (x86_64)** | `bandstat-vX.X.X-x86_64-unknown-linux-gnu.tar.gz` |

**macOS**: バイナリは署名されていないためセキュリティの警告が表示されます。自己責任において bandstat を実行する場合は `xattr -d com.apple.quarantine ./bandstat` を実行するか、ソースからビルドしてください。

**Windows**: WSL 経由で Linux バイナリを使用してください。

## 使い方

```
bandstat audio.wav                                   # 単一ファイル分析
bandstat my_mix.wav ref.wav                          # ファイル比較（最初が基準）
bandstat --time audio.wav                            # タイムライン分析
bandstat --time --interval 10 --weighted audio.wav   # 10秒間隔、K-weighted
bandstat --quiet audio.wav                           # 静音モード
bandstat --no-color audio.wav                        # 色出力を無効化
```

### オプション

| オプション | 短縮形 | 説明 |
|------------|--------|------|
| `--time` | `-t` | タイムライン分析モード |
| `--interval <SECONDS>` | `-i` | タイムライン間隔（デフォルト: 20） |
| `--weighted` | `-w` | タイムラインに K-weighting を適用 |
| `--quiet` | `-q` | 説明を省略 |
| `--no-color` | | 色出力を無効化 |

### 出力の見方

* **Raw(%)**: 各帯域のパワー分布
* **K-wt(%)**: Raw と同じだが K-weighting 適用
* **Diff**: K-wt から Raw を引いた値（正 = 測定値より大きく聞こえる）
* **Dyn(dB)**: 帯域ごとのダイナミクス（低い = 圧縮が強い）

### 対応フォーマット

WAV, AIFF, MP3, FLAC

### 周波数帯域

| 帯域 | 範囲 (Hz) | 説明 |
|------|-----------|------|
| DC   | 0-20      | 可聴域以下 |
| SUB1 | 20-40     | 深いサブベース |
| SUB2 | 40-60     | サブベース |
| BASS | 60-120    | ベース |
| UBAS | 120-250   | アッパーベース |
| LMID | 250-500   | ローミッド |
| MID  | 500-1000  | ミッド |
| UMID | 1000-2000 | アッパーミッド |
| HMID | 2000-4000 | ハイミッド |
| PRES | 4000-6000 | プレゼンス |
| BRIL | 6000-10000 | ブリリアンス |
| HIGH | 10000-14000| 高域 |
| UHIG | 14000-18000| 超高域 |
| AIR  | 18000+     | エアー |

DC 帯域は不要な DC オフセットや低域ノイズの検出に役立ちます。サブベースを SUB1/SUB2 に分割しているのは、モニター環境により聴き分けが難しい場合がある低域の問題を診断するためです。

## ビルド

bandstat は Rust で書かれています。ビルドには Rust 1.85 以降が必要です。

```
$ git clone https://github.com/cloned/bandstat.git
$ cd bandstat
$ cargo build --release
$ ./target/release/bandstat --help
```

### テストの実行

```
$ cargo test
```

## ライセンス

MIT
